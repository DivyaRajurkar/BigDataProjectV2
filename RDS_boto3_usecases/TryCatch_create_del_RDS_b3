import boto3  # AWS SDK for Python to interact with AWS services like RDS
import botocore.exceptions  # For handling AWS-specific client errors

try:
    # âœ… Creating a client session for RDS  
    # âš ï¸ **Security Note:** Hardcoding credentials is not recommended.  
    #    Use environment variables, IAM roles, or AWS Secrets Manager for better security.  
    client = boto3.client('rds',
                          region_name="ap-south-1",  # ğŸŒ Specify the AWS region
                          aws_access_key_id='YOUR_ACCESS_KEY',  # ğŸ”’ AWS Access Key (HIDDEN for security)
                          aws_secret_access_key='YOUR_SECRET_KEY'  # ğŸ”’ AWS Secret Key (HIDDEN for security)
                          )

    try:
        # ğŸ—‘ï¸ Deleting an existing RDS instance
        # DBInstanceIdentifier: Name of the RDS instance to delete
        # SkipFinalSnapshot=True: Skips the final snapshot before deletion (use with caution)
        # DeleteAutomatedBackups=True: Deletes automated backups associated with the instance
        print("Deleting RDS instance...")
        response = client.delete_db_instance(
            DBInstanceIdentifier='newpoc112',  # ğŸ·ï¸ Identifier for the DB instance to delete
            SkipFinalSnapshot=True,  # ğŸš« Skipping final snapshot creation
            DeleteAutomatedBackups=True  # ğŸ§¹ Removing automated backups
        )
        print("RDS instance deleted successfully.")  # âœ… Deletion confirmation message
    except botocore.exceptions.ClientError as e:
        # âš¡ Handles errors specific to AWS RDS deletion
        print(f"Error deleting RDS instance: {e}")

    try:
        # ğŸ” Checking available RDS instances after deletion
        # Calls describe_db_instances() to list any remaining DB instances
        print("Checking available RDS instances...")
        response = client.describe_db_instances()  # ğŸ“‹ Describes all existing DB instances
        print(response)  # ğŸ–¨ï¸ Prints the details of available instances
    except botocore.exceptions.ClientError as e:
        # âš¡ Handles errors while describing instances
        print(f"Error describing RDS instances: {e}")

    try:
        # ğŸš€ Creating a new RDS instance in AWS
        # DBName: Specifies the database name
        # AllocatedStorage: Storage allocated for the database (in GB)
        # DBInstanceClass: Defines the DB instance type (CPU & memory configuration)
        # Engine: Specifies the DB engine (e.g., MySQL, PostgreSQL)
        # MasterUsername & MasterUserPassword: Credentials for database access (password hidden for security)
        # PubliclyAccessible=True: Makes the instance accessible from the internet (ensure proper security groups)
        print("Creating new RDS instance...")
        response = client.create_db_instance(
            DBName='mysqldbtestdb',  # ğŸ·ï¸ Database name
            DBInstanceIdentifier='newpoc1',  # ğŸ·ï¸ Identifier for the new DB instance
            AllocatedStorage=20,  # ğŸ’¾ Allocated storage in GB
            DBInstanceClass='db.t4g.micro',  # âš¡ Instance class (CPU & memory configuration)
            Engine='mysql',  # âš™ï¸ Database engine
            MasterUsername='admin',  # ğŸ‘¤ Master username for DB access
            MasterUserPassword='YOUR_DB_PASSWORD',  # ğŸ”’ Master password (HIDDEN for security)
            PubliclyAccessible=True  # ğŸŒ Makes the DB instance publicly accessible (secure appropriately)
        )
        print("RDS instance created successfully.")  # âœ… Confirmation message after successful creation
    except botocore.exceptions.ClientError as e:
        # âš¡ Handles errors during the creation process
        print(f"Error creating RDS instance: {e}")

except Exception as e:
    # ğŸ›‘ Handles any unexpected errors during execution
    print(f"Unexpected error: {e}")
